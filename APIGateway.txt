API Gateway


What is an API Gateway?
    - Serves as a single entry point for client requests
        + Routes requests to backend services
        + Separates external APIs from internal systems
    - Central control layer in microservice architectures
    - Reduces client complexity
    - Prevents tight coupling between clients and services
    - Handles cross-cutting concerns
        + Authentication
        + Rate limiting
        + Caching
        + SSL termination
        + Logging


Core Responsibilities
    1. Request Validation
        + Validate URL paths
        + Validate headers
        + Validate request body
        + Enforce schemas
        + Reject malformed requests early
    2. Middleware
        + Authentication
        + Authorization
        + Rate limiting
        + IP allow/deny lists
        + Request logging
        + Header normalization
    3. Routing
        + Maps requests to backend services
        + Based on:
            * Paths
            * HTTP methods
            * Headers
            * Query params
        + Example:
            routes:
                - path: /users/*
                  service: user-service
                  port: 8080
                - path: /orders/*
                  service: order-service
                  port: 8081
                - path: /payments/*
                  service: payment-service
                  port: 8082
    4. Backend Communication
        + Forwards requests securely
        + Supports protocol translation (HTTP ↔ gRPC)
        + Implements retries and timeouts
        + Performs basic load balancing
        + Preserves tracing headers
    5. Response Transformation
        + Converts internal formats to client formats
        + Enables backend flexibility
        + Example:
            Client → HTTP
            Gateway → gRPC
            Response → JSON
    6. Caching
        + Reduces backend load
        + Improves latency
        + Strategies:
            * Full response cache
            * Partial cache
            * TTL-based invalidation
            * Event-based invalidation
        + Storage:
            * In-memory
            * Redis
            * CDN


Security
    - Authentication
        + OAuth2
        + JWT
        + API keys
        + mTLS
    - Authorization
        + Role-based access
        + Policy enforcement
    - Encryption
        + TLS everywhere
        + Secure headers
    - Protection
        + DDoS mitigation
        + WAF integration
        + Bot detection


Scaling an API Gateway
    - Horizontal Scaling
        + Multiple instances
        + Load balancer in front
        + Auto-scaling
    - Global Scaling
        + Multi-region deployment
        + GeoDNS routing
        + Config synchronization
    - High Availability
        + Health checks
        + Failover routing
        + Rolling upgrades


Observability
    - Logging
        + Access logs
        + Error logs
        + Audit logs
    - Metrics
        + Latency
        + Throughput
        + Error rate
        + Cache hit rate
    - Tracing
        + Distributed tracing
        + Correlation IDs


Popular API Gateways
    - Managed Services
        1. AWS API Gateway
            + Native AWS integration
            + REST and WebSocket support
            + Usage plans
            + Lambda integration
            + CloudWatch metrics
        2. Azure API Management
            + OAuth/OpenID support
            + Policy engine
            + Developer portal
        3. Google Cloud Endpoints
            + GCP integration
            + gRPC support
            + OpenAPI support
    - Open Source
        1. Kong
            + NGINX-based
            + Large plugin ecosystem
            + Service mesh support
        2. Tyk
            + Go-based
            + GraphQL support
            + Built-in analytics
        3. Gravitee
            + Design-first
            + Event-native APIs
            + Analytics portal


When NOT to Use an API Gateway
    - Simple monolithic systems
    - Single backend applications
    - Low-traffic internal tools
    - Prototypes and MVPs
    - Examples:
        + Personal blog
        + Internal admin tools
        + Early-stage prototypes


Best Practices
    - Keep gateway stateless
    - Avoid heavy business logic
    - Version APIs
    - Use circuit breakers
    - Enforce quotas
    - Document endpoints
    - Monitor performance
    - Secure admin access
    - Automate configuration
